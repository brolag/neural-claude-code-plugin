# Wildcard Bash Permissions for Neural Loop
# Pattern 5: Auto-approve safe command patterns
#
# These patterns enable truly autonomous loops without interruption.
# All patterns are safe read-only or tested operations.

version: "1.0"
description: "Auto-approve patterns for autonomous Neural Loops"

# AUTO-APPROVE PATTERNS
# These commands are approved automatically when matched
wildcards:
  # ============================================
  # TESTING - Always safe, provides feedback
  # ============================================
  - pattern: "pytest **/*.py"
    auto_approve: true
    description: "Run Python tests"

  - pattern: "pytest tests/**"
    auto_approve: true
    description: "Run tests in tests directory"

  - pattern: "npm test"
    auto_approve: true
    description: "Run npm tests"

  - pattern: "npm run test*"
    auto_approve: true
    description: "Run any npm test script"

  - pattern: "npx vitest*"
    auto_approve: true
    description: "Run vitest tests"

  - pattern: "npx jest*"
    auto_approve: true
    description: "Run jest tests"

  # ============================================
  # LINTING - Read-only, provides feedback
  # ============================================
  - pattern: "npm run lint*"
    auto_approve: true
    description: "Run linter"

  - pattern: "npx eslint*"
    auto_approve: true
    description: "Run ESLint"

  - pattern: "npx prettier --check*"
    auto_approve: true
    description: "Check formatting"

  # ============================================
  # TYPE CHECKING - Read-only
  # ============================================
  - pattern: "npx tsc --noEmit*"
    auto_approve: true
    description: "TypeScript type check"

  - pattern: "npm run typecheck*"
    auto_approve: true
    description: "Run type checking"

  # ============================================
  # BUILD - Creates artifacts, safe
  # ============================================
  - pattern: "npm run build*"
    auto_approve: true
    description: "Run build"

  - pattern: "npx vite build*"
    auto_approve: true
    description: "Vite build"

  # ============================================
  # GIT READ-ONLY - Information gathering
  # ============================================
  - pattern: "git status*"
    auto_approve: true
    description: "Check git status"

  - pattern: "git diff*"
    auto_approve: true
    description: "View git diff"

  - pattern: "git log*"
    auto_approve: true
    description: "View git history"

  - pattern: "git branch*"
    auto_approve: true
    description: "List/view branches"

  - pattern: "git show*"
    auto_approve: true
    description: "Show commit details"

  # ============================================
  # OUR SCRIPTS - Vetted and safe
  # ============================================
  - pattern: "bash .claude/scripts/*.sh"
    auto_approve: true
    description: "Run Claude scripts"
    exclude_patterns:
      - "*rm *"
      - "*delete*"
      - "*drop*"
      - "*force*"

  - pattern: "bash .claude/scripts/**/*.sh"
    auto_approve: true
    description: "Run nested Claude scripts"
    exclude_patterns:
      - "*rm *"
      - "*delete*"

  # ============================================
  # PACKAGE INFO - Read-only
  # ============================================
  - pattern: "npm list*"
    auto_approve: true
    description: "List packages"

  - pattern: "npm outdated*"
    auto_approve: true
    description: "Check outdated packages"

  - pattern: "npm info*"
    auto_approve: true
    description: "Package info"

  # ============================================
  # FILE SYSTEM READ - Information gathering
  # ============================================
  - pattern: "ls *"
    auto_approve: true
    description: "List files"

  - pattern: "tree *"
    auto_approve: true
    description: "Directory tree"

  - pattern: "wc -l *"
    auto_approve: true
    description: "Count lines"

  - pattern: "du -sh *"
    auto_approve: true
    description: "Disk usage"

  # ============================================
  # CLAUDE CODE - Our own tools
  # ============================================
  - pattern: "claude --version"
    auto_approve: true
    description: "Check Claude version"

# ============================================
# DENY PATTERNS - Never auto-approve
# ============================================
deny_patterns:
  # Destructive file operations
  - "rm -rf *"
  - "rm -r *"
  - "rmdir *"

  # Dangerous git operations
  - "git push --force*"
  - "git push -f*"
  - "git reset --hard*"
  - "git clean -fd*"

  # System modification
  - "chmod 777*"
  - "sudo *"
  - "chown *"

  # Remote execution
  - "curl * | bash"
  - "wget * | bash"
  - "curl * | sh"

  # Database drops
  - "*DROP DATABASE*"
  - "*DROP TABLE*"
  - "*TRUNCATE*"

  # Environment secrets
  - "echo $*_KEY*"
  - "echo $*_SECRET*"
  - "echo $*_TOKEN*"
  - "printenv *KEY*"

# ============================================
# CONTEXT-SPECIFIC APPROVALS
# ============================================
contexts:
  neural-loop:
    description: "Additional approvals during Neural Loop"
    extra_patterns:
      - pattern: "git add ."
        auto_approve: true
        description: "Stage all changes"
      - pattern: "git commit -m *"
        auto_approve: true
        description: "Commit with message"

  tdd:
    description: "TDD-specific approvals"
    extra_patterns:
      - pattern: "pytest -x *"
        auto_approve: true
        description: "Stop on first failure"
      - pattern: "pytest --lf *"
        auto_approve: true
        description: "Run last failed"
